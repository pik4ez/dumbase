dumbase
=======

Загружает дамп базы данных с боевого сервера и раскатывает его на среде разработки.


Возможности
-----------

* Просмотр списка таблиц в базе данных.
* Контроль над загружаемыми таблицами (перечисление или исключение).
* Повторное использование последнего загруженного дампа.
* Простота локализации.
* Возможность добавления поддержки других движков баз данных.


Установка
---------

1. Загрузить скрипт (`git clone`).
1. Установить права на выполнение (`chmod +x dumbase.py`).
1. Сгенерировать бинарные файлы локализации для необходимой локали (см. ниже).


Использование
-------------

### Получение списка таблиц ###

```
./dumbase.py list $dsn
  $dsn  параметры доступа к базе данных в формате [$user@]$host[:$port]/$dbname
```

Подробная справка: `dumbase.py list -h`


### Загрузка дампа ###

```
./dumbase.py dump $source_dsn $target_dsn
  $source_dsn  параметры доступа к базе, из которой берутся данные
  $target_dsn  параметры доступа к базе, в которую выгружаются данные
```

Подробная справка: `dumbase.py dump -h`

#### Полезные плюшки ####

`-e` исключает таблицу или список таблиц (через пробел) из дампа

`-i` включает таблицу или список таблиц в дамп (полезно при использовании `-c`)

`-c` исключает все таблицы из дампа, используется совместно с `-i`

`-t` добавляет триггеры в дамп (могут потребоваться рутовые права)

`-f` принудительно снимает дамп даже при наличии дампа в кэше

`-s` позволяет указать список таблиц, для которых будет снята только схема,
без данных

`--init-schema` создаёт пустые таблицы (схему), если эти таблицы исключены
из полного дампа

#### Примеры ####

`./dumbase.py dump -c -i t1 -- $source $target`
снимает дамп одной таблицы, `t1`, включая данные

`./dumbase.py dump -e t2 t3 -- $source $target`
снимает дамп всех таблиц (с данными), исключая `t2` и `t3`

`./dumbase.py dump --init-schema -e t1 t2 -- $source $target`
снимает дамп с данными для всех таблиц, кроме `t1` и `t2`, создаёт пустые
таблицы `t1` и `t2` (поскольку они исключены из полного дампа и указан
параметр `--init-schema`)

`./dumbase.py dump -c -i t1 -s t2 t3 -- $source $target`
снимает дамп с данными для таблицы `t1`, создаёт пустые таблицы `t2` и `t3`

`./dumbase.py dump -f $source $target`
снимает полный дамп с данными, не используя кэш


Генерация файлов локализации
----------------------------

В директории `locale/` содержатся файлы локализации в виде текста. Для корректной
работы механизма локализации необходимо сгенерировать бинарные файлы для соответствующих
локалей. Можно воспользоваться любыми утилитами, генерирующими бинарные файлы
в формате .mo из текстовых файлов в формате .po, например, утилитой msgfmt.py.

Пример для локали ru\_RU:
```
cd /path/to/dumbase
msgfmt -o locale/ru_RU/LC_MESSAGES/dumbase.mo locale/ru_RU/LC_MESSAGES/dumbase.po
```


Автодополнение
--------------

```
pip install argcomplete
activate-global-python-argcomplete
```

Подробности: https://argcomplete.readthedocs.org/en/latest/


